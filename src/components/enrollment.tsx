/* eslint-disable @typescript-eslint/no-misused-promises */
import * as z from 'zod';

/**
 * This code was generated by v0 by Vercel.
 * @see https://v0.dev/t/XChuqWMY264
 */
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "src/components/ui/card"
import { Form, FormControl, FormDescription, FormField, FormItem, FormLabel, FormMessage } from '~/components/ui/form';
import type { OnboardingState, RouterSchema } from '~/pages/enroll';
import { useEffect, useState } from 'react';

import { Button } from '~/components/ui/button';
import { Input } from '~/components/ui/input';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';

const formSchema = z.object({
    name: z.string().min(2).max(50),
    email: z.string().email(),
    studioCode: z.string().min(5).max(5)
});

export type FormSchema = z.infer<typeof formSchema>;

type Props = {
    query: RouterSchema | undefined,
    setFormData: (data: FormSchema) => void,
    setState: (state: OnboardingState) => void,
}

export function Enrollment(props: Props) { // TODO: fix code autopopulation
  const code = props.query ? props.query.code : "";

  const [defaultCode, setDefaultCode] = useState<string>("");

  useEffect(() => {
    if (code) {
      setDefaultCode(code);
    }
  }, [code]);

  const form = useForm<FormSchema>({
    resolver: zodResolver(formSchema),
    defaultValues: {
      name: "",
      email: "",
      studioCode: code,
    },
  });

  const onSubmit = (data: FormSchema) => {
    props.setFormData(data);
    props.setState("schedule");
  };
  return (
    <div className="flex justify-center items-center min-h-screen bg-gray-100">
      <Card className="w-full max-w-md mx-auto">
        <CardHeader>
          <CardTitle className="text-center">Enroll in a Studio</CardTitle>
          <CardDescription className="text-center">
            Enter your name, email and studio code to enroll.
          </CardDescription>
        </CardHeader>
        <CardContent className="">
          <Form {...form}>
          <form className="space-y-4" onSubmit={form.handleSubmit(onSubmit)}>
            <FormField
                control={form.control}
                name="name"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>Name</FormLabel>
                    <FormControl>
                      <Input placeholder="First Last" {...field} />
                    </FormControl>
                    <FormDescription>
                      Your full name as you would like it to appear to the studio.
                    </FormDescription>
                    <FormMessage />
                  </FormItem>
                )}
                />
            <FormField
              control={form.control}
              name="email"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Email</FormLabel>
                  <FormControl>
                    <Input placeholder="name@gmail.com" {...field} />
                  </FormControl>
                  <FormDescription>
                    Your email to save for future communication.
                  </FormDescription>
                  <FormMessage />
                </FormItem>
              )}
              />
              <FormField
              control={form.control}
              name="studioCode"
              defaultValue={defaultCode}
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Studio Code</FormLabel>
                  <FormControl>
                    <Input placeholder="12345" {...field} />
                  </FormControl>
                  <FormDescription>
                    The 5 digit studio code sent to you by your teacher.
                  </FormDescription>
                  <FormMessage />
                </FormItem>
              )}
              />
            <Button className="w-full" type="submit">
              Go
            </Button>
          </form>
          </Form>
        </CardContent>
      </Card>
    </div>
  )
}
